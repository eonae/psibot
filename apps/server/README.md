# SpeechKit Server (TypeScript)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π –∏–∑ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–µ–π.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üì± –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram –±–æ—Ç–∞
- üé§ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ Yandex SpeechKit –∏ Salute Speech (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- ü§ñ –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–º–æ—â—å—é GPT-4o —á–µ—Ä–µ–∑ OpenRouter
- üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ Redis
- üìÅ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤
- üîå –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20+
- Redis
- ffmpeg
- Yandex Cloud API –∫–ª—é—á–∏
- Salute Speech API –∫–ª—é—á
- OpenRouter API –∫–ª—é—á
- Telegram Bot Token

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏:
```bash
cp .env.example .env
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis:
```bash
docker compose -f ../docker-compose.infra.yaml up -d
```

4. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
```bash
npm run build
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
npm start
```

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
npm run dev
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **Dependency Injection**: –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- **Repository Pattern**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏
- **Adapter Pattern**: –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ STT, LLM, Storage

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ models/           # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ ports/            # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îú‚îÄ‚îÄ telegram/         # Telegram bot
‚îÇ   ‚îú‚îÄ‚îÄ storage/          # FileStorage —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ repository/       # JobRepository —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ stt/              # Speech-to-Text –∞–¥–∞–ø—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ llm/              # LLM –∞–¥–∞–ø—Ç–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ loaders/          # File loaders
‚îî‚îÄ‚îÄ index.ts              # Entry point
```

## Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **Download** - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (Telegram, –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫, Google Drive)
2. **Convert** - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WAV —Ñ–æ—Ä–º–∞—Ç
3. **Transcribe** - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (Yandex SpeechKit + Salute Speech)
4. **Merge** - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. **Postprocess** - LLM –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## –ó–∞–º–µ–Ω—è–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–µ–Ω—ã:

- `FileStorage` - –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ S3, Google Cloud Storage –∏ —Ç.–¥.
- `JobRepository` - –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ PostgreSQL, MongoDB –∏ —Ç.–¥.
- `SpeechToText` - –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- `LLM` - –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–π LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- `FileLoader` - –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–π–ª–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `.env.example`):

- Telegram bot token
- Yandex Cloud API keys (SpeechKit + S3)
- Salute Speech API key
- OpenRouter API key
- Redis connection
- Storage path

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫/Google Drive
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

- MP3
- M4A
- OGG
- WAV
- WEBM

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä
npm run lint

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
npm run build
```

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- [x] TypeScript –ø—Ä–æ–µ–∫—Ç —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- [x] –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- [x] –ê–¥–∞–ø—Ç–µ—Ä—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è (LocalFileStorage, RedisJobRepository)
- [x] –ó–∞–≥—Ä—É–∑—á–∏–∫–∏ —Ñ–∞–π–ª–æ–≤ (Telegram, Yandex Disk, Google Drive)
- [x] –ê–¥–∞–ø—Ç–µ—Ä—ã STT (Yandex SpeechKit, Salute Speech - –∑–∞–≥–ª—É—à–∫–∞)
- [x] –ê–¥–∞–ø—Ç–µ—Ä LLM (OpenRouter GPT-4o)
- [x] –°–µ—Ä–≤–∏—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Download, Convert, Transcribe, Merge, Postprocess)
- [x] Telegram –±–æ—Ç —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
- [x] –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### TODO
- [ ] –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å Salute Speech API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å S3 storage —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–ø–æ–ª–Ω–æ—Å—Ç—å—é, –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å REST API endpoints
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

